<html>
<!-- Latest compiled and minified CSS -->
<!-- <link href="http://brobin.github.io/hacker-bootstrap/css/hacker.css" rel="stylesheet"> -->
<!-- Latest compiled and minified CSS -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<style>
body {
    background-image: url('https://hs-prod-content.imgix.net/pack-foundations-level_1-pattern-mob-player__1493939248895.ai?fm=png32&or=6&w=1920');
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-position: center;
}

.clickButton {
	    -webkit-box-align: center;
	    -webkit-box-orient: horizontal;
	    -webkit-box-direction: normal;
	    -webkit-box-pack: center;
	    cursor: pointer;
	    color: rgb(253, 245, 235);
	    fill: rgb(253, 245, 235);
	    font-weight: 700;
	    height: 40px;
	    padding-left: 30px;
	    padding-right: 30px;
	    position: relative;
	    font-family: Apercu, sans-serif;
	    font-style: normal;
	    letter-spacing: 2.5px;
	    font-size: 12px;
	    line-height: 16px;
	    display: inline-flex;
	    flex-direction: row;
	    justify-content: center;
	    align-items: center;
	    text-transform: uppercase;
	    background-color: transparent;
	    border-width: 2px;
	    border-style: solid;
	    border-color: rgb(253, 245, 235);
	    border-image: initial;
	    transition: all 0.2s ease-in-out;
	    border-radius: 20px;
}
.css-1y368wo {
    -webkit-box-align: center;
    -webkit-box-pack: center;
    -webkit-box-direction: normal;
    -webkit-box-orient: vertical;
    z-index: 10;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    display: flex;
    flex: 1 0 auto;
}


.dropdown {
    display: inline-block;
}

.well {
	min-height: 90%;
	color: white;
	background-color: #F57D2F;
	outline: none;
	padding-left: 10px;
	border: 4px solid white !important;
}

.wellZing {
	color: white;
	background-color: #F57D2F;
	font-size: 30px;
	outline: none;
	border: 4px solid white !important;
}


</style>




<body bgcolor="#F48C45">

<script>

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

async function testWait() {
    alert('going to wait for 5 second');
    await wait(5000);
    alert('finally wait is over');
}

function wait(time) {
    return new Promise(resolve => {
        setTimeout(() => {
            resolve();
        }, time);
    });
}

function newOutput(message) {
	var outputVal = document.getElementById("newOutput");
	outputVal.innerHTML += message;
}

function oldOutput(message) {
	var outputVal = document.getElementById("oldOutput");
	outputVal.innerHTML += message;
}

var audios = new Array();

function setToPlay(audioFile, time, fileName, sessionType, tempNum, timeNum) {
setTimeout(function(){ audioFile.play(); }, time);
}

function streamAudio(sessionType, time){
	stopAllAudio();
	var url = "/getStructure/" + sessionType + "/" + time;
	console.log(url);
	jsonString = httpGet(url);
	obj = JSON.parse(jsonString);
	var prevEnd = 0.0;
	var fileName = "static/Mp3/" + sessionType + "/" + time + "/0" + ".mp3";
   	var audio = new Audio(fileName);
	audios.push(audio);
	setToPlay(audio, 0, fileName, sessionType, 0, time);
	oldOutput("<b>Playing " + sessionType + "/" + time + ".mp3" + "</b><br>");
	for (fileIndex in obj) {

		// This is a NUMBER VALUE
		listElem = obj[fileIndex];
		var tempNum = parseInt(fileIndex) + 1;
		console.log(tempNum);
		if (tempNum < obj.length) {
			var fileName = "static/Mp3/" + sessionType + "/" + time + "/" + tempNum + ".mp3";

			var audio = new Audio(fileName);
			audios.push(audio);
			newOutput("<b>" + sessionType + "/" + time + "/" + tempNum + ".mp3 starts at " + listElem.End + "s" + "</b><br>");
			newOutput("<b>time.sleep(" + listElem.Duration + ")" + "</b><br>");
			setToPlay(audio, listElem.End*1000, fileName, sessionType, tempNum, time);
			}
       }
    }

  function play(elemName){
	   var headerOutput = document.getElementById("headerOutput");
	   headerOutput.innerHTML = "<h3>Playing: <b>" + elemName + "</b></h3>";
	   headerOutput.innerHTML += "<h4>Previous File Size: <b>" + elemName + "</b></h4>";
	   headerOutput.innerHTML += "<h4>New File Size: <b>" + elemName + "</b></h4>";
	   headerOutput.innerHTML += "<h4>Bandwidth Reduction: <b>" + elemName + "</b></h4>";
       var audio = document.getElementById(elemName);
       audio.play();
                 }



function stopAllAudio(){
	console.log(audios);
	for (a in audios) {
		audios[a].pause();
	}
}

function resetElems() {

	var highestTimeoutId = setTimeout(";");
	for (var i = 0 ; i < highestTimeoutId ; i++) {
	    clearTimeout(i);
	}
	var elems = [];
	var times = [];
	{% for fileInfo in DATABASE %}
		{% for soundClip in fileInfo.Files %}
			elems.push("{{ soundClip.Elem }}");
			times.push("{{ soundClip.Time }}")
		{% endfor %}
	{% endfor %}
	var i;
	for (ele in elems) {
		i = ele;
		ele = elems[ele];
		console.log(ele);
		document.getElementById(ele + "Span").innerHTML = times[i] + " MIN";
		sound = document.getElementsByTagName("audio");
		for(var i = 0; i < sound.length; i++) {
			sound[i].pause();
		}
	}}
   </script>



<div class="container" style="padding-top: 10px;">
	<div class="row">
		<div class="col-md-3 well text-center">
			<p>
				<b>
					Old Method of Distributing Audio
				</b>
			</p>
			<p id="oldOutput"></p>
		</div>

		<div class="col-md-6"  style="border: 0px solid white; padding-bottom: 10px; padding-top: -10px;">
				<b><font color='white'><div align='center' style="text-align: left; border: 3px solid white; margin: 0 auto; padding-left: 30px; padding: 10px; min-height: 226px;" id="headerOutput"><center><h1>Press any Audio Button to Continue</h1></center></div></font></b>
			<center>
					{% for fileInfo in DATABASE %}
						<h4><font color="white">{{ fileInfo.Description }}</font></h4>
						{% for soundClip in fileInfo.Files %}
								<div data-component="mindful-button" id="ember899" style="margin-left: 12px;" class="clickButton"><div tabindex="0" aria-label="Change current variation from 5 min" role="button"onclick='resetElems();document.getElementById("{{ soundClip.Elem }}Span").innerHTML = "Playing";streamAudio("{{ soundClip.SessionType }}", "{{ soundClip.Time }}");'>
									<audio preload="none" id="{{ soundClip.Elem }}" src="{{ soundClip.Filename }}" ></audio>
									<!---->  <span id="{{ soundClip.Elem }}Span">
									                    {{ soundClip.Time }} min

									  </span>
									</div>
									</div>
						{% endfor %}
					{% endfor %}
			</center>
		</div>
		<div class="col-md-3 well text-center">
			<p>
				<b>
					New Method of Distributing Audio
				</b>
			</p>
			<p id="newOutput"></p>
		</div>
	</div>
</div>
</body>
</html>

